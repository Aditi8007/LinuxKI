<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:.5in .5in .5in .5in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-GB link="#0563C1" vlink="#954F72">

<div class=WordSection1>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;vertical-align:top'><b><i><span lang=EN-US style='font-size:12.0pt;
font-family:"Arial",sans-serif;color:black'>LinuxKI Warning</span></i></b></p>

<p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
text-align:center;line-height:11.25pt;vertical-align:top'><b><span lang=EN-US
style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>​​​​High SYS CPU time by processes
reading /proc/stat such as ora_diag and ora_lmhb</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>11/27/2018</span></p>

<p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
text-align:center;line-height:11.25pt;vertical-align:top'><span lang=EN-US
style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>Problem</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>On a large multi-core server (32-socket,
896-core Superdome Flex server) running SLES 12 SP3, the Oracle processes
ora_lmhb and ora_diag were observed consuming a lot of CPU time each using top
and other performance tools. </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>Investigation</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>LinuxKI data was taken for analysis.&nbsp;
&nbsp;For example:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
Courier;color:black'>$ cd /dev/mem&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
Courier;color:black'>$ runki&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>The Kparse Report (kp.*.html) showed the
following:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width="100%"
 style='width:100.0%;background:#FFD1A4'>
 <tr>
  <td style='padding:1.5pt 2.25pt 1.5pt 2.25pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:13.5pt;
  font-family:"Times New Roman",serif'>1.2.2 Top Tasks sorted by System Time</span></b></p>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><u><span style='font-size:10.0pt;font-family:"Times New Roman",serif;
  color:blue'>[Prev Subsection]---[Prev Section][Next Section][Table of
  Contents]</span></u></p>
  </td>
 </tr>
</table>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><b><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
PID       RunTime      SysTime     UserTime     RunqTime    SleepTime  Command</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><u><span style='font-size:9.0pt;font-family:"Courier New";color:blue;
background:yellow'>870705</span></u><span style='font-size:9.0pt;font-family:
"Courier New";color:black;background:yellow'>      18.251696    18.245947    
0.002008     0.155491     1.591656  ora_lmhb_ppts20_1</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><u><span style='font-size:9.0pt;font-family:"Courier New";color:blue;
background:yellow'>870303</span></u><span style='font-size:9.0pt;font-family:
"Courier New";color:black;background:yellow'>      17.717444    17.711872    
0.001743     0.264589     2.016732  ora_diag_ppts20_1</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><u><span style='font-size:9.0pt;font-family:"Courier New";color:blue'>713039</span></u><span
style='font-size:9.0pt;font-family:"Courier New";color:black'>     
10.047533     8.289723     1.751160     0.026742     9.925885  BESClient</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><u><span style='font-size:9.0pt;font-family:"Courier New";color:blue'>870785</span></u><span
style='font-size:9.0pt;font-family:"Courier New";color:black'>      
5.663522     3.506284     1.745775     0.630501    13.706123  ora_lg00_ppts20_1</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><u><span style='font-size:9.0pt;font-family:"Courier New";color:blue'>870845</span></u><span
style='font-size:9.0pt;font-family:"Courier New";color:black'>      
3.527778     2.896833     0.608868     0.309465    16.162773  ora_lg10_ppts20_1</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>Analysis of the processes will show the process
spending a lot of time in mutex_optimistic_spin(), kstat_irqs_usr(), and
kstat_irqs():</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>PID
870705  ora_lmhb_ppts20_1</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'> 
PPID 1  /usr/lib/systemd/systemd</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
********* SCHEDULER ACTIVITY REPORT ********</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
<span style='background:yellow'>RunTime    : 18.251696  SysTime   : 18.245947</span>  
UserTime   :  0.002008</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
SleepTime  :  1.591656  Sleep Cnt :     45233   Wakeup Cnt :     67159</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
RunQTime   :  0.155491  Switch Cnt:     45258   PreemptCnt :        25</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
HardIRQ    :  0.000000  HardIRQ-S :  0.000000    HardIRQ-U :  0.000000</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
SoftIRQ    :  0.003741  SoftIRQ-S :  0.003740    SoftIRQ-U :  0.000001</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
Last CPU   :        74  CPU Migrs :        11   NODE Migrs :         0</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
Policy     : SCHED_NORMAL     vss :  1208048787          rss :     15733</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
busy    :     91.26%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>     
<span style='background:yellow'>sys   :     91.24%</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>     
user  :      0.01%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>     
irq   :      0.02%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
runQ    :      0.78%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
sleep   :      7.96%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
******** CPU ACTIVITY REPORT ********</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
The percentages below reflect the percentage </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
of the Thread's total RunTime spent in either</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
User code or System code </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
RunTime:  18.2517</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>     
Count    USER     SYS    INTR</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>      
1520       0    1520       0</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>              
0.00% 100.00%   0.00%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
HARDCLOCK entries</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>      
Count     Pct  State  Function</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>        
<span style='background:yellow'>902  59.34%  SYS    mutex_optimistic_spin</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>        
<span style='background:yellow'>420  27.63%  SYS    kstat_irqs_usr</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
<span style='background:yellow'>77   5.07%  SYS    kstat_irqs</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
70   4.61%  SYS    try_to_wake_up</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
14   0.92%  SYS    traverse</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
12   0.79%  SYS    thread_return</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
10   0.66%  SYS    get_idle_time</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
10   0.66%  SYS    __mutex_lock_slowpath</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>          
3   0.20%  SYS    show_stat</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>          
2   0.13%  SYS    __mutex_unlock_slowpath</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>      
Count     Pct  HARDCLOCK Stack trace</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>      
============================================================</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>        
420  27.63%  <span style='background:yellow'>kstat_irqs_usr  show_stat 
traverse  seq_lseek  proc_reg_llseek  __fdget_pos  sys_lseek</span> 
tracesys_phase2  unknown  |  __lseek_nocancel  skgpgextradiag  skgpdiagpid 
ksdhng_diag_proc_int  ksdhng_diag_proc  kjdgpstack_wTimeout</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>        
411  27.04%  <span style='background:yellow'>mutex_optimistic_spin 
__mutex_lock_slowpath  mutex_lock  kstat_irqs_usr  show_stat  traverse 
seq_lseek  proc_reg_llseek  __fdget_pos  sys_lsee</span>k  tracesys_phase2 
unknown  |  __lseek_nocancel  skgpgextradiag  skgpdiagpid</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>        
253  16.64%  <span style='background:yellow'>mutex_optimistic_spin 
__mutex_lock_slowpath  put_dec  mutex_lock  kstat_irqs_usr  show_stat 
traverse  seq_lseek  proc_reg_llseek  __fdget_pos  sys_lseek</span> 
tracesys_phase2  unknown  |  __lseek_nocancel  skgpgextradiag</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>        
205  13.49%  <span style='background:yellow'>mutex_optimistic_spin 
__mutex_lock_slowpath  wake_up_q  mutex_lock  kstat_irqs_usr  show_stat 
traverse  seq_lseek  proc_reg_llseek  __fdget_pos  sys_lseek</span> 
tracesys_phase2  unknown  |  __lseek_nocancel  skgpgextradiag</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
77   5.07%  <span style='background:yellow'>kstat_irqs  kstat_irqs_usr 
show_stat  traverse  seq_lseek  proc_reg_llseek  __fdget_pos  sys_lseek</span> 
tracesys_phase2  unknown  |  __lseek_nocancel  skgpgextradiag  skgpdiagpid 
ksdhng_diag_proc_int  ksdhng_diag_proc</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>...</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
******** FILE ACTIVITY REPORT ********</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
FD: 47 REG      dev: 0x4 <span style='background:yellow'>/proc/stat</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
System Call Name     Count     Rate     ElpTime        Avg        Max   
Errs    AvSz     KB/s</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
<span style='background:yellow'>lseek                  119      5.9   19.930841</span>  
0.167486   0.529970       0</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>      
SLEEP             45228   2261.4    1.591586   0.000035</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>         
Sleep Func     45228             1.591586   0.000035   0.058111 
__mutex_lock_slowpath</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>      
RUNQ                                0.155473</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>      
<span style='background:yellow'>CPU                                18.183782</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>   
read                   120      6.0    0.000729   0.000006   0.000009      
0    1023      6.0</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal'><span style='font-size:9.0pt;font-family:"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>Note the process is spending a significant
amount of time in lseek() on the /proc/stat file.  </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>Source code analysis of show_stat(),
kstat_irqs_usr(), and kstat_irqs() shows that if /proc/stat is read in a
non-sequential pattern, then the IRQ statistics must be recalculated for each
IRQ from the per-CPU counters.    This sever has 896 CPU cores and 3957 IRQs,
which results in a lot of CPU time as well as spinlock contention if multiple
processes are involved.   </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>Analyzing the system call pattern for the
Oracle lmhb process above shows that it is indeed accessing the /proc/stat file
in a non-sequential fashion:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>$  grep &quot;pid=870705 &quot; ki.1* | grep &quot;
syscallbeg= &quot; | more</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    0.060598 cpu=81 pid=870705 tgid=870705 <span
style='background:yellow'>read</span> [0] ret=0x3ff syscallbeg=    0.000005
fd=47 *buf=0x7ffe4eec3ea0 <span style='background:yellow'>count=1023</span>
type=REG dev=0x00000004 ino=4026532144</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    0.242494 cpu=81 pid=870705 tgid=870705 <span
style='background:yellow'>lseek</span> [8] ret=0x154d syscallbeg=    0.181886
fd=47 <span style='background:yellow'>offset=0x154d</span> whence=SEEK_SET</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    0.242508 cpu=81 pid=870705 tgid=870705 <span
style='background:yellow'>read</span> [0] ret=0x3ff syscallbeg=    0.000007
fd=47 *buf=0x7ffe4eec3ea0 <span style='background:yellow'>count=1023</span>
type=REG dev=0x00000004 ino=4026532144</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    0.392642 cpu=81 pid=870705 tgid=870705 <span
style='background:yellow'>lseek</span> [8] ret=0x1587 syscallbeg=    0.150126
fd=47 <span style='background:yellow'>offset=0x1587</span> whence=SEEK_SET</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    0.392656 cpu=81 pid=870705 tgid=870705 <span
style='background:yellow'>read</span> [0] ret=0x3ff syscallbeg=    0.000007
fd=47 *buf=0x7ffe4eec3ea0 <span style='background:yellow'>count=1023</span>
type=REG dev=0x00000004 ino=4026532144</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    0.514025 cpu=81 pid=870705 tgid=870705 <span
style='background:yellow'>lseek</span> [8] ret=0x15c0 syscallbeg=    0.121360
fd=47 <span style='background:yellow'>offset=0x15c0</span> whence=SEEK_SET</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>Note from above that the process reads 1023
bytes of data, but “rewinds” the file pointer from the previous offset + a few bytes,
which results in non-sequential access of the /proc/stat file and causes the
IRQ statistics to be recalculated on each lseek() on the /proc/stat file.   </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>This non-sequential access to the /proc/stat
file can impact other processes on the system that also accesses /proc/stat
with sequential access (mpstat, vmstat, top, sar, etc.).   </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>Solution</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>As of the current writing, no solution is
currently available.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>One potential solution is for Oracle to address
the non-sequential access of the /proc/stat file.    A request was filed with
Oracle.   Please contact Oracle if there is an urgent need for a solution.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>Note that the Linux community is aware of the
impact with lots of IRQs when reading /proc/stat (even sequentially) and
several solutions have been discussed.   For further details, refer to the
following links:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span class=MsoHyperlink><span lang=EN-US
style='font-size:10.0pt;font-family:"Arial",sans-serif'><a
href="https://lkml.org/lkml/2018/4/19/834">https://lkml.org/lkml/2018/4/19/834</a></span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span class=MsoHyperlink><span lang=EN-US
style='font-size:10.0pt;font-family:"Arial",sans-serif'><a
href="https://lore.kernel.org/lkml/1524157769-30775-1-git-send-email-longman@redhat.com/">https://lore.kernel.org/lkml/1524157769-30775-1-git-send-email-longman@redhat.com/</a></span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span class=MsoHyperlink><span lang=EN-US
style='font-size:10.0pt;font-family:"Arial",sans-serif'><a
href="https://www.mail-archive.com/linux-kernel@vger.kernel.org/msg1714635.html">https://www.mail-archive.com/linux-kernel@vger.kernel.org/msg1714635.html</a></span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif'>&nbsp;</span></p>

</div>

</body>

</html>
