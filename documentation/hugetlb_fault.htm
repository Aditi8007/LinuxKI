<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:0in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
a:link, span.MsoHyperlink
	{color:#0563C1;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:#954F72;
	text-decoration:underline;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:8.0pt;
	margin-left:.5in;
	line-height:107%;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;}
.MsoChpDefault
	{font-family:"Calibri",sans-serif;}
.MsoPapDefault
	{margin-bottom:8.0pt;
	line-height:107%;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:.5in .5in .5in .5in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-GB link="#0563C1" vlink="#954F72">

<div class=WordSection1>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;text-align:
justify;vertical-align:top'><b><i><span lang=EN-US style='font-size:12.0pt;
font-family:"Arial",sans-serif;color:black'>LinuxKI Warning</span></i></b></p>

<p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
text-align:center;line-height:11.25pt;vertical-align:top'><b><span lang=EN-US
style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>​​​​Lock contention using large
Oracle SGA and huge pages on large multi-core systems </span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>11/30/2018</span></p>

<p class=MsoNormal align=center style='margin-bottom:0in;margin-bottom:.0001pt;
text-align:center;line-height:11.25pt;vertical-align:top'><span lang=EN-US
style='font-size:10.0pt;font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>Problem</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>Recently, a customer with a large multi-core
server (32-sockets, 896 cores), experienced higher than expected System CPU
time after Oracle was started.     Customer was using Oracle 12c with an Oracle
SGA over 5 TB in size.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>SLES 12 SP3 was installed on the HPE Superdome
Flex server.   </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>Investigation</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>LinuxKI data was taken for analysis.&nbsp;
&nbsp;For example:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
Courier;color:black'>$ cd /dev/mem&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
Courier;color:black'>$ runki&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>The CPU Profiling Report (kiprof.*.txt) showed
the following:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>******** GLOBAL HARDCLOCK REPORT ********</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>  Count   USER%    SYS%   INTR%   IDLE%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'> 626986  28.01%  13.86%   1.11%  57.02%</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>Kernel Functions executed during profile</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>   Count     Pct  State  Function</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>  179377  28.61%  USER   UNKNOWN</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>   <span style='background:yellow'>32925   5.25% 
SYS    rwsem_down_write_failed</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>   21562   3.44%  SYS    queued_spin_lock_slowpath</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    4077   0.65%  SYS    try_to_wake_up</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    2742   0.44%  INTR   sock_def_readable</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    2247   0.36%  SYS    thread_return</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    1270   0.20%  SYS    ktime_get_ts64</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>     889   0.14%  SYS    handle_pte_fault</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>     852   0.14%  SYS    syscall_trace_enter_phase2</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>     812   0.13%  SYS    generic_make_request</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>     751   0.12%  SYS    do_smart_update</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
Courier;color:black'>non-idle GLOBAL HARDCLOCK STACK TRACES (sort by count):</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>   Count     Pct  Stack trace</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>============================================================</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    9666   1.54%  queued_spin_lock_slowpath 
sys_semctl  tracesys_phase2  unknown</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    5235   0.83%  <span style='background:yellow'>rwsem_down_write_failed</span> 
wake_up_q  rwsem_wake  call_rwsem_down_write_failed  down_write  <span
style='background:yellow'>huge_pmd_share  huge_pte_alloc  hugetlb_fault</span> 
<span style='background:yellow'>handle_mm_fault  __do_page_fault  do_page_fault</span> 
syscall_return_slowpath  <span style='background:yellow'>page_fault</span> 
page_fault  unknown</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    4908   0.78%  <span style='background:yellow'>rwsem_down_write_failed</span> 
apparmor_inode_getattr  vfs_getattr_nosec  uv_read_rtc  ktime_get 
call_rwsem_down_write_failed  down_write  <span style='background:yellow'>huge_pmd_share 
huge_pte_alloc  hugetlb_fault</span>  audit_filter_rules.isra.9  <span
style='background:yellow'>handle_mm_fault  __do_page_fault  do_page_fault</span> 
syscall_return_slowpath  <span style='background:yellow'>page_fault</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    4158   0.66%  <span style='background:yellow'>rwsem_down_write_failed</span> 
sock_def_readable  uv_read_rtc  ktime_get  call_rwsem_down_write_failed  down_<span
style='background:yellow'>write  huge_pmd_share  huge_pte_alloc  hugetlb_fault</span> 
task_cputime_adjusted  audit_filter_rules.isra.9  <span style='background:yellow'>handle_mm_fault 
__do_page_fault</span>   syscall_return_slowpath  <span style='background:yellow'>page_fault</span></span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    3929   0.63%  unknown</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    3244   0.52%  queued_spin_lock_slowpath  SYSC_semtimedop 
ktime_get  enqueue_entity  enqueue_task_fair  audit_filter_rules.isra.9 
uv_read_rtc  ktime_get  __audit_syscall_entry  tracesys_phase2  unknown</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    1850   0.30%  try_to_wake_up  wake_up_q 
rwsem_wake  call_rwsem_wake  up_write  <span style='background:yellow'>huge_pmd_share 
huge_pte_alloc  hugetlb_fault</span>  <span style='background:yellow'>handle_mm_fault 
__do_page_fault</span>   syscall_return_slowpath  <span style='background:yellow'>page_fault</span>  
unknown</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>    1697   0.27%  <span style='background:yellow'>rwsem_down_write_failed</span> 
udp_recvmsg  uv_read_rtc  ktime_get  call_rwsem_down_write_failed  down_write  <span
style='background:yellow'>huge_pmd_share  huge_pte_alloc  hugetlb_fault</span> 
audit_filter_rules.isra.9  <span style='background:yellow'>handle_mm_fault 
__do_page_fault</span>   syscall_return_slowpath  <span style='background:yellow'>page_fault</span>
</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'><br>
</span><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>Note that the top System profile hits occured in the context of
the rwsem_down_write_failed() function.&nbsp;  This function can be called from
many other functions, so it’s important to view the stack traces to see where it’s
called.     With LinuxKI, the stack traces with SLES is “inexact”, meaning that
stale functions can be seen in the stack traces.   But notice there are
consistent functions highlighted in yellow which show the rwsem_down_write_failed
function being called in the context of a page fault, specifically a hugepage
fault (hugetlb_fault).</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>In this Oracle instance, the SGA is comprised
of multiple shared memory segments, but the majority of the allocation is in a
single shared memory segment:</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>$ grep -e &quot;oracle&quot; -e &quot;Shared&quot;
-e &quot;shmid&quot; ipcs-m.0926_1001</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>------ Shared Memory Segments --------</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>key        shmid      owner      perms  
bytes         nattch     status</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0x00000000 422281243  oracle     640    
8388608       2805</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black;background:yellow'>0x00000000 422314012  oracle    
640     4946191712256 2805</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0x00000000 422346781  oracle     640    
1604321280    2805</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:9.0pt;font-family:
"Courier New";color:black'>0x4fecd804 422379550  oracle     640    
667648        2805</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>Here, note that one of the shared memory
segments is nearly 5TB is size.   </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>By default, Oracle will allocate the memory
pages as they are first accessed using page faults.   When using hugepages, you
will see the hugetlb_fault() function in the trace records.     Of course, the
shared memory’s address space must be locked to add the memory pages to the
object, and with lots of Oracle processes and 896 cores, this can increase the
lock contention.</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:10.0pt;font-family:
"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>Solution</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><b><span lang=EN-US style='font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></b></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>There are 2 potential solutions to
the lock contention when handling the SGA page faults: </span></p>

<p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:"Arial",sans-serif;color:black'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpFirst style='margin-top:0in;margin-right:0in;
margin-bottom:0in;margin-left:.25in;margin-bottom:.0001pt;text-indent:-.25in;
line-height:11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>On Oracle 11g, set _enable_NUMA_spport to TRUE</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-top:0in;margin-right:0in;
margin-bottom:0in;margin-left:.25in;margin-bottom:.0001pt;line-height:11.25pt;
vertical-align:top'><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-top:0in;margin-right:0in;
margin-bottom:0in;margin-left:.25in;margin-bottom:.0001pt;line-height:11.25pt;
vertical-align:top'><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>Prior to Oracle 12c, when _enable_NUMA_support was set to TRUE,
Oracle would setup divide the large memory object into 1 shared memory segment
per NUMA node.  Having one shared memory segment per node would distribute the
lock contention over more memory objects to relieve the contention.   </span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-top:0in;margin-right:0in;
margin-bottom:0in;margin-left:.25in;margin-bottom:.0001pt;line-height:11.25pt;
vertical-align:top'><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-top:0in;margin-right:0in;
margin-bottom:0in;margin-left:.25in;margin-bottom:.0001pt;line-height:11.25pt;
vertical-align:top'><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>However, with Oracle 12c, Oracle would revert back to one shared
memory segment for the large memory object and divide the shared memory segment
internally into memory regions or areas.   So this method cannot be used to
reduce the lock contention with Oracle 12c.</span></p>

<p class=MsoListParagraphCxSpMiddle style='margin-top:0in;margin-right:0in;
margin-bottom:0in;margin-left:.25in;margin-bottom:.0001pt;line-height:11.25pt;
vertical-align:top'><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>&nbsp;</span></p>

<p class=MsoListParagraphCxSpLast style='margin-top:0in;margin-right:0in;
margin-bottom:0in;margin-left:.25in;margin-bottom:.0001pt;text-indent:-.25in;
line-height:11.25pt;vertical-align:top'><span lang=EN-US style='font-size:10.0pt;
font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span lang=EN-US style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:black'>Set shmmax so that Oracle must divide the large shared memory
object into multiple shared memory segments.   If shmmax is not large enough
for the Oracle SGA, then Oracle will allocate as many shared memory segments as
needed.    For example, setting shmmax to 512 GB (549,755,813,888 bytes), would
result in 9 shared memory segments so the spinlock contention would now be
across 9 memory objects instead of 1.   </span></p>

</div>

</body>

</html>
